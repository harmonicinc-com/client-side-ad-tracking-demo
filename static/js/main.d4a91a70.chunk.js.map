{"version":3,"sources":["AdTrackingContext.tsx","AdPodList.tsx","ErrorContext.tsx","useInterval.tsx","SessionContext.tsx","SimpleAdTracker.tsx","AdTrackingPlaybackSessionProvider.tsx","ShakaPlayer.tsx","PlayerContainer.tsx","InfoSection.tsx","App.tsx","reportWebVitals.tsx","index.tsx"],"names":["AdTrackingContext","React","createContext","undefined","useStyles","makeStyles","itemText","fontSize","whiteSpace","overflow","textOverflow","podItem","podItemOnAir","backgroundColor","background","adItem","paddingLeft","theme","spacing","adItemOnAir","trackingUrlItem","paddingTop","paddingBottom","greenIcon","color","redIcon","AdPodList","classes","adTrackingContext","useContext","Error","useState","expandPods","setExpandPods","expandAds","setExpandAds","pods","adPods","playheadInMs","lastPlayheadTime","presentationStartTime","shouldExpandPod","pod","id","startTime","duration","shouldExpandAd","ad","getPlayhead","rawTime","className","List","map","ListItem","button","onClick","newState","Object","keys","filter","key","find","p","forEach","toggleExpandPod","ListItemIcon","ListItemText","disableTypography","Date","toLocaleString","toFixed","Collapse","in","timeout","unmountOnExit","ads","startsWith","toggleExpandAd","trackingEvents","trackingUrl","index","reportingState","event","signalingUrls","ErrorContext","errors","reportError","acknowledgeError","DefaultErrorContextProvider","props","setErrors","Provider","value","message","acknowledged","error","children","useInterval","callback","delay","savedCallback","useRef","useEffect","current","setInterval","clearInterval","SessionContext","AD_END_TRACKING_EVENT_TIME_TOLERANCE_MS","mergeAds","existingAds","updated","i","adId","a","splice","length","existingAd","prftStartTime","t","push","SimpleAdTracker","lastPlayheadUpdateTime","listeners","this","listener","indexOf","existingPods","podId","existingPod","mergePods","notifyListeners","time","now","getTime","speed","iterateTrackingEvents","endTime","sendBeacon","needSendBeacon","handler","time0","time1","podStartTime","adStartTime","Promise","all","url","fetch","response","status","console","AdTrackingPlaybackSessionProvider","EARLY_FETCH_MS","history","useHistory","location","useLocation","urlQueryParam","URLSearchParams","search","get","errorContext","adTrackerRef","setPresentationStartTime","localSessionId","mediaUrl","manifestUrl","adTrackingMetadataUrl","sessionInfo","setSessionInfo","setLastPlayheadTime","lastPrftPlayheadTime","setLastPrftPlayheadTime","setAdPods","start","end","lastDataRange","setLastDataRange","rewriteUrlToMetadataUrl","replace","refreshMetadata","useCallback","prft","isInRange","range","dataRange","prftStart","prftEnd","log","json","updatePods","adBreaks","loadMedia","redirect","cache","redirected","includes","getAdPods","addUpdateListener","toISOString","sessionContext","load","encodeURIComponent","unload","updatePlayheadTime","updatePrftPlayheadTime","updatePresentationStartTime","pause","resume","mute","unmute","ShakaPlayer","player","videoRef","containerRef","lastMuted","paused","createRef","window","muxjs","video","container","shaka","Player","configure","muted","ui","Overlay","controlPanelElements","addEventListener","err","onError","getControls","isSeeking","onResume","onPaused","onMute","onUnmute","getPlayheadTimeAsDate","currentTime","getPresentationLatencyInfo","getPresentationStartTimeAsDate","ref","style","maxWidth","width","height","autoPlay","Component","PlayerContainer","shakaRef","localSessionRef","rawCurrentTime","setRawCurrentTime","playhead","setPlayhead","prftWallClock","setPrftWallClock","streamFormat","setStreamFormat","timeMsToNextBreak","wallClock","Infinity","Math","min","getRawVideoTime","clockTime","prftClockTime","rawClockTime","getPresentationStartTime","updateTime","ceil","buttons","marginRight","InfoSection","urlInputRef","preventDefault","entries","Snackbar","anchorOrigin","vertical","horizontal","open","elevation","variant","severity","onClose","errorKey","Typography","gutterBottom","TextField","inputRef","label","fullWidth","defaultValue","Box","display","flexDirection","Button","Link","href","underline","createTheme","palette","primary","main","secondary","paper","padding","textAlign","text","App","StyledEngineProvider","injectFirst","ThemeProvider","basename","exact","path","Container","Grid","item","xs","Paper","square","sm","Tabs","indicatorColor","textColor","Tab","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","debug","ReactDOM","render","StrictMode","CssBaseline","document","getElementById"],"mappings":"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","file":"static/js/main.d4a91a70.chunk.js","sourcesContent":["import React from 'react';\nimport SimpleAdTrackerInterface from \"../types/SimpleAdTrackerInterface\";\n\nconst AdTrackingContext = React.createContext<SimpleAdTrackerInterface | undefined>(undefined);\n\nexport default AdTrackingContext;\n","import { useContext, useState } from 'react';\nimport makeStyles from '@mui/styles/makeStyles';\nimport { Collapse, List, ListItem, ListItemText, ListItemIcon } from '@mui/material';\nimport MovieIcon from '@mui/icons-material/Movie';\nimport FolderIcon from '@mui/icons-material/Folder';\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\nimport ErrorIcon from '@mui/icons-material/Error';\nimport HourglassFullIcon from '@mui/icons-material/HourglassFull';\nimport RadioButtonUncheckedIcon from '@mui/icons-material/RadioButtonUnchecked';\nimport ExpandLess from '@mui/icons-material/ExpandLess';\nimport ExpandMore from '@mui/icons-material/ExpandMore';\nimport AdTrackingContext from './AdTrackingContext';\nimport {theme} from \"./App\";\nimport {Ad, AdBreak} from \"../types/AdBeacon\";\n\nconst useStyles = makeStyles(() => ({\n  itemText: {\n    fontSize: 13,\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\"\n  },\n  podItem: {\n  },\n  podItemOnAir: {\n    backgroundColor: \"#42a5f5\",\n    '&:hover': {\n      background: \"#2196f3\",\n    }\n  },\n  adItem: {\n    paddingLeft: theme.spacing(4),\n  },\n  adItemOnAir: {\n    paddingLeft: theme.spacing(4),\n    backgroundColor: \"#90caf9\",\n    '&:hover': {\n      background: \"#64b5f6\",\n    }\n  },\n  trackingUrlItem: {\n    paddingLeft: theme.spacing(8),\n    paddingTop: theme.spacing(0),\n    paddingBottom: theme.spacing(1)\n  },\n  greenIcon: {\n    color: 'green'\n  },\n  redIcon: {\n    color: 'red'\n  }\n}));\n\nfunction AdPodList() {\n  const classes = useStyles();\n\n  const adTrackingContext = useContext(AdTrackingContext);\n\n  if (adTrackingContext === undefined) {\n    throw new Error('AdTrackingContext is undefined');\n  }\n\n  const [expandPods, setExpandPods] = useState<{[key: string]: boolean}>({});\n\n  const [expandAds, setExpandAds] = useState<{[key: string]: boolean}>({});\n\n  const pods = adTrackingContext.adPods || [];\n\n  const playheadInMs = adTrackingContext.lastPlayheadTime;\n\n  const presentationStartTime = adTrackingContext.presentationStartTime;\n\n  const shouldExpandPod = (pod: AdBreak): boolean => {\n    const keepPastPodFor = 2000;\n    if (pod.id in expandPods) {\n      return expandPods[pod.id];\n    } else {\n      return playheadInMs !== null && playheadInMs < pod.startTime + pod.duration + keepPastPodFor;\n    }\n  }\n\n  const toggleExpandPod = (pod: AdBreak) => {\n    const newState = {\n      ...expandPods,\n      [pod.id]: !shouldExpandPod(pod)\n    };\n    Object.keys(expandPods)\n      .filter(key => !pods.find(p => p.id === key))\n      .forEach(key => delete newState[key]);\n    setExpandPods(newState);\n  }\n\n  const shouldExpandAd = (ad: Ad, pod: AdBreak) => {\n    const keepPastAdFor = 2000;\n    if (pod.id + '/' + ad.id in expandAds) {\n      return expandAds[pod.id + '/' + ad.id];\n    } else {\n      return playheadInMs !== null && playheadInMs < ad.startTime + ad.duration + keepPastAdFor;\n    }\n  }\n\n  const toggleExpandAd = (ad: Ad, pod: AdBreak) => {\n    const newState = {\n      ...expandAds,\n      [pod.id + '/' + ad.id]: !shouldExpandAd(ad, pod)\n    };\n    Object.keys(expandAds)\n      .filter(key => !pods.find(p => key.startsWith(p.id + '/')))\n      .forEach(key => delete newState[key]);\n    setExpandAds(newState);\n  };\n\n  const getPlayhead = (rawTime: number) => rawTime + presentationStartTime;\n\n  return (\n    <div className=\"ad-pod-list\">\n      {pods ?\n        <List>\n          {pods.map((pod) =>\n            <div key={pod.id}>\n              <ListItem button onClick={() => toggleExpandPod(pod)} className={pod.startTime < playheadInMs && playheadInMs < pod.startTime + pod.duration ? classes.podItemOnAir : classes.podItem}>\n                <ListItemIcon>\n                  <FolderIcon />\n                </ListItemIcon>\n                <ListItemText disableTypography className={classes.itemText}>\n                  <div>\n                    Ad Pod: {pod.id}\n                  </div>\n                  <div>\n                    Time: {new Date(getPlayhead(pod.startTime)).toLocaleString()}, Duration: {(pod.duration / 1000).toFixed(1)}s\n                  </div>\n                </ListItemText>\n                {shouldExpandPod(pod) ? <ExpandLess /> : <ExpandMore />}\n              </ListItem>\n              <Collapse key={pod.id + \".ads\"} in={shouldExpandPod(pod)} timeout=\"auto\" unmountOnExit>\n                <List>\n                  {pod.ads.map((ad) =>\n                    <div key={ad.id}>\n                      <ListItem button onClick={() => toggleExpandAd(ad, pod)} className={ad.startTime < playheadInMs && playheadInMs < ad.startTime + ad.duration ? classes.adItemOnAir : classes.adItem}>\n                        <ListItemIcon>\n                          <MovieIcon />\n                        </ListItemIcon>\n                        <ListItemText disableTypography className={classes.itemText}>\n                          <div>\n                            Ad: {ad.id}\n                          </div>\n                          <div>\n                            Time: {new Date(getPlayhead(ad.startTime)).toLocaleString()}, Duration: {(ad.duration / 1000).toFixed(1)}s\n                          </div>\n                        </ListItemText>\n                        {shouldExpandAd(ad, pod) ? <ExpandLess /> : <ExpandMore />}\n                      </ListItem>\n                      <Collapse key={ad.id + \".trackingUrls\"} in={shouldExpandAd(ad, pod)} timeout=\"auto\" unmountOnExit>\n                        <List>\n                          {ad.trackingEvents ?\n                            ad.trackingEvents.map((trackingUrl,index) =>\n                              <ListItem key={index} className={classes.trackingUrlItem}>\n                                <ListItemIcon>\n                                  {trackingUrl.reportingState === \"IDLE\" ? <RadioButtonUncheckedIcon /> : null}\n                                  {trackingUrl.reportingState === \"REPORTING\" ? <HourglassFullIcon /> : null}\n                                  {trackingUrl.reportingState === \"DONE\" ? <CheckCircleIcon className={classes.greenIcon} /> : null}\n                                  {trackingUrl.reportingState === \"ERROR\" ? <ErrorIcon className={classes.redIcon} /> : null}\n                                </ListItemIcon>\n                                <ListItemText disableTypography className={classes.itemText}>\n                                  <div>\n                                    Event: {trackingUrl.event}\n                                  </div>\n                                  <div>\n                                    URL: {trackingUrl.signalingUrls}\n                                  </div>\n                                  {trackingUrl.startTime ?\n                                    <div>\n                                      Time: {new Date(getPlayhead(trackingUrl.startTime)).toLocaleString()}\n                                    </div>\n                                    : null}\n                                </ListItemText>\n                              </ListItem>\n                            )\n                            : null\n                          }\n                        </List>\n                      </Collapse>\n                    </div>\n                  )}\n                </List>\n              </Collapse>\n            </div>\n          )}\n        </List>\n        : null\n      }\n    </div>\n  );\n}\n\nexport default AdPodList;\n","import React, { useState } from 'react';\nimport ErrorContextInterface, {Errors} from \"../types/ErrorContextInterface\";\n\nconst ErrorContext = React.createContext<ErrorContextInterface>({\n    errors: {},\n    reportError: () => {},\n    acknowledgeError: () => {}\n});\n\nfunction DefaultErrorContextProvider(props: any) {\n    const [errors, setErrors] = useState<Errors>({});\n\n    const reportError = (key: string, message: string) => {\n        setErrors({\n            ...errors,\n            [key]: {\n                message: message,\n                acknowledged: false\n            }\n        });\n    }\n\n    const acknowledgeError = (key: string) => {\n        const error = errors[key];\n        if (error) {\n            setErrors({\n                ...errors,\n                [key]: {\n                    ...error,\n                    acknowledged: true\n                }\n            });\n        }\n    }\n\n    return (\n        <ErrorContext.Provider value={{errors, reportError, acknowledgeError}}>\n            {props.children}\n        </ErrorContext.Provider>\n    );\n}\n\nexport { ErrorContext, DefaultErrorContextProvider } ;\n","// https://overreacted.io/making-setinterval-declarative-with-react-hooks/\n\nimport { useEffect, useRef } from 'react';\n\nfunction useInterval(callback: () => void, delay?: number) {\n  const savedCallback = useRef<() => void>();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      if (!savedCallback.current) return;\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n\nexport default useInterval;\n","import React from 'react';\nimport SessionContextInterface from \"../types/SessionContextInterface\";\n\nconst SessionContext = React.createContext<SessionContextInterface | undefined>(undefined);\n\nexport default SessionContext;\n","import SimpleAdTrackerInterface from \"../types/SimpleAdTrackerInterface\";\nimport {Ad, AdBreak, TrackingEvent} from \"../types/AdBeacon\";\n\nconst AD_END_TRACKING_EVENT_TIME_TOLERANCE_MS = 500;\nconst MAX_TOLERANCE_IN_SPEED = 2;\n// Allow event to be emitted <tolerance> ms after its start time\n// Used for events that have zero duration\nconst MAX_TOLERANCE_EVENT_END_TIME_MS = 500;\n\nconst mergePods = (existingPods: AdBreak[], pods: AdBreak[]) => {\n    let updated = false;\n\n    for (let i = existingPods.length - 1; i >= 0; i--) {\n        const podId = existingPods[i].id;\n        if (!pods.find(p => p.id === podId)) {\n            existingPods.splice(i, 1);\n            updated = true;\n        }\n    }\n    pods.forEach((pod) => {\n        let existingPod = existingPods.find(p => p.id === pod.id);\n        if (!existingPod) {\n            existingPod = {\n                id: pod.id,\n                startTime: pod.prftStartTime || pod.startTime,\n                duration: pod.duration,\n                ads: []\n            };\n            existingPods.push(existingPod);\n            updated = true;\n        } else if (existingPod.duration !== pod.duration) {\n            existingPod.duration = pod.duration;\n            updated = true;\n        }\n        updated = mergeAds(existingPod.ads, pod.ads) || updated;\n    });\n\n    return updated;\n}\n\nconst mergeAds = (existingAds: Ad[], ads: Ad[]) => {\n    let updated = false;\n\n    for (let i = existingAds.length - 1; i >= 0; i--) {\n        const adId = existingAds[i].id;\n        if (!ads.find(a => a.id === adId)) {\n            existingAds.splice(i, 1);\n            updated = true;\n        }\n    }\n    ads.forEach((ad) => {\n        let existingAd = existingAds.find(a => a.id === ad.id);\n        if (!existingAd) {\n            existingAd = {\n                id: ad.id,\n                startTime: ad.prftStartTime || ad.startTime,\n                duration: ad.duration,\n                trackingEvents: ad.trackingEvents.map(t => ({\n                    event: t.event,\n                    startTime: t.prftStartTime || t.startTime,\n                    duration: t.duration,\n                    signalingUrls: t.signalingUrls,\n                    reportingState: \"IDLE\"\n                }))\n            };\n            existingAds.push(existingAd);\n            updated = true;\n        } else if (existingAd.duration !== ad.duration) {\n            existingAd.duration = ad.duration;\n            updated = true;\n        }\n    });\n\n    return updated;\n}\n\nexport default class SimpleAdTracker implements SimpleAdTrackerInterface {\n    adPods: AdBreak[];\n    lastPlayheadTime: number;\n    presentationStartTime: number;\n    private lastPlayheadUpdateTime: number;\n    private listeners: (() => void)[];\n\n    constructor() {\n        this.adPods = [];\n        this.lastPlayheadTime = 0;\n        this.presentationStartTime = 0;\n        this.lastPlayheadUpdateTime = 0;\n        this.listeners = [];\n    }\n\n    addUpdateListener(listener: () => void) {\n        this.listeners.push(listener);\n    }\n\n    removeUpdateListener(listener: () => void) {\n        const index = this.listeners.indexOf(listener);\n        if (index !== -1) {\n            this.listeners.splice(index, 1);\n        }\n    }\n\n    updatePods(pods: AdBreak[]) {\n        const updated = mergePods(this.adPods, pods);\n        if (updated) {\n            this.notifyListeners();\n        }\n    }\n\n    needSendBeacon(time: number) {\n        const now = new Date().getTime();\n        if (this.lastPlayheadUpdateTime) {\n            if (now === this.lastPlayheadUpdateTime) {\n                return;\n            }\n\n            const speed = (time - this.lastPlayheadTime) / (now - this.lastPlayheadUpdateTime);\n            if (speed > 0 && speed <= MAX_TOLERANCE_IN_SPEED) {\n                this.iterateTrackingEvents((trackingUrl) => {\n                    const startTime = trackingUrl.startTime;\n                    const endTime = startTime + (trackingUrl.duration || MAX_TOLERANCE_EVENT_END_TIME_MS);\n                    if (endTime && trackingUrl.reportingState === \"IDLE\" &&\n                        startTime <= time && time <= endTime\n                    ) {\n                        this.sendBeacon(trackingUrl);\n                    }\n                }, this.lastPlayheadTime, time);\n            }\n        }\n        this.lastPlayheadTime = time;\n        this.lastPlayheadUpdateTime = now;\n    }\n\n    updatePlayheadTime(time: number) {\n        this.needSendBeacon(time);\n    }\n\n    updatePrftPlayheadTime(time: number): void {\n        this.needSendBeacon(time);\n    }\n\n    updateRawPlayheadTime(time: number): void {\n        this.needSendBeacon(time);\n    }\n\n    updatePresentationStartTime(time: number): void {\n        this.presentationStartTime = time;\n    }\n\n    getAdPods() {\n        return this.adPods;\n    }\n\n    pause() {\n        this.iterateTrackingEvents((trackingUrl) => {\n            if (trackingUrl.event === \"pause\") {\n                this.sendBeacon(trackingUrl);\n            }\n        });\n    }\n\n    resume() {\n        this.iterateTrackingEvents((trackingUrl) => {\n            if (trackingUrl.event === \"resume\") {\n                this.sendBeacon(trackingUrl);\n            }\n        });\n    }\n\n    mute() {\n        this.iterateTrackingEvents((trackingUrl) => {\n            if (trackingUrl.event === \"mute\") {\n                this.sendBeacon(trackingUrl);\n            }\n        });\n    }\n\n    unmute() {\n        this.iterateTrackingEvents((trackingUrl) => {\n            if (trackingUrl.event === \"unmute\") {\n                this.sendBeacon(trackingUrl);\n            }\n        });\n    }\n\n    // private\n\n    notifyListeners() {\n        this.listeners.forEach((listener) => {\n            listener();\n        });\n    };\n\n    iterateTrackingEvents(handler: (a: TrackingEvent, b: Ad, c: AdBreak) => void, time0 = this.lastPlayheadTime, time1 = this.lastPlayheadTime) {\n        this.adPods.forEach((pod) => {\n            const podStartTime = pod.startTime;\n            if (podStartTime <= time1 && time0 <= podStartTime + pod.duration + AD_END_TRACKING_EVENT_TIME_TOLERANCE_MS) {\n                pod.ads.forEach((ad) => {\n                    const adStartTime = ad.startTime;\n                    if (adStartTime <= time1 && time0 <= adStartTime + ad.duration + AD_END_TRACKING_EVENT_TIME_TOLERANCE_MS) {\n                        ad.trackingEvents.forEach((trackingUrl) => {\n                            handler(trackingUrl, ad, pod);\n                        });\n                    }\n                });\n            }\n        });\n    }\n\n    async sendBeacon(trackingUrl: TrackingEvent) {\n        trackingUrl.reportingState = \"REPORTING\";\n        this.notifyListeners();\n\n        try {\n            await Promise.all(trackingUrl.signalingUrls.map(async url => {\n                const response = await fetch(url);\n                if (response.status < 200 && response.status > 299) {\n                    console.error(`Failed to send beacon to ${url}; Status ${response.status}`);\n                    throw new Error(`Failed to send beacon to ${url}; Status ${response.status}`);\n                }\n            }))\n            trackingUrl.reportingState = \"DONE\"\n        } catch (err) {\n            trackingUrl.reportingState = \"ERROR\";\n        }\n        this.notifyListeners();\n    };\n}\n","import {useState, useEffect, useRef, useContext, useCallback} from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport useInterval from './useInterval';\nimport { ErrorContext } from './ErrorContext';\nimport AdTrackingContext from './AdTrackingContext';\nimport SessionContext from './SessionContext';\nimport SimpleAdTracker from './SimpleAdTracker';\nimport SimpleAdTrackerInterface from \"../types/SimpleAdTrackerInterface\";\nimport SessionContextInterface from \"../types/SessionContextInterface\";\nimport AdBeacon, {DataRange} from \"../types/AdBeacon\";\nimport ErrorContextInterface from \"../types/ErrorContextInterface\";\n\nconst AdTrackingPlaybackSessionProvider = (props: any) => {\n    const AD_TRACING_METADATA_FILE_NAME = \"metadata\";\n\n    // Fetch the next metadata n ms early. Used in isInRange().\n    const EARLY_FETCH_MS = 5000;\n\n    const history = useHistory();\n    const location = useLocation();\n    const searchParams = new URLSearchParams(location.search);\n    const urlQueryParam = searchParams.get(\"url\");\n\n    const errorContext = useContext<ErrorContextInterface>(ErrorContext);\n\n    const adTrackerRef = useRef<SimpleAdTracker>();\n    const [presentationStartTime, setPresentationStartTime] = useState(0);\n\n    const [sessionInfo, setSessionInfo] = useState({\n        localSessionId: \"\",\n        mediaUrl: urlQueryParam,\n        manifestUrl: null,\n        adTrackingMetadataUrl: \"\",\n    });\n    const [lastPlayheadTime, setLastPlayheadTime] = useState(0);\n    const [lastPrftPlayheadTime, setLastPrftPlayheadTime] = useState(0);\n    const [adPods, setAdPods] = useState<any>([]);\n    const [lastDataRange, setLastDataRange] = useState<DataRange>({\n        start: 0,\n        end: 0,\n    });\n\n    const rewriteUrlToMetadataUrl = (url: string) => {\n        return url.replace(/\\/[^/?]+(\\??[^/]*)$/, '/' + AD_TRACING_METADATA_FILE_NAME + '$1');\n    }\n\n    const refreshMetadata = useCallback(async (url: string, time = 0, prft = false): Promise<boolean> => {\n        const isInRange = (time: number, prft: boolean, range?: DataRange) => {\n            // Bypass checking only if time === 0, not null | undefined\n            // Happens on initial load.\n            if (time === 0) return true;\n            const dataRange = range || lastDataRange;\n            if (prft && dataRange.prftStart && dataRange.prftEnd) {\n                return time >= dataRange.prftStart && time <= dataRange.prftEnd - EARLY_FETCH_MS;\n            } else {\n                return time >= dataRange.start && time <= dataRange.end - EARLY_FETCH_MS;\n            }\n        }\n\n        console.log(`refreshMetadata: ${url}`);\n        if (url) {\n            try {\n                const response = await fetch(url);\n                if (response.status < 200 || response.status > 299) {\n                    throw new Error(`Get unexpected response code ${response.status}`);\n                }\n                const json: AdBeacon = await response.json();\n                setLastDataRange(json.dataRange);\n\n                if (!isInRange(time, prft, json.dataRange)) {\n                    console.log(`Invalid metadata: Not in range. Time: ${time}, PRFT: ${prft}`, json.dataRange);\n                    return false;\n                }\n\n                if (adTrackerRef.current !== undefined) {\n                    adTrackerRef.current.updatePods(json.adBreaks || []);\n                    return true;\n                }\n            } catch (err) {\n                console.error(\"Failed to download metadata for ad tracking\", err);\n                errorContext.reportError(\"metadata.request.failed\", \"Failed to download metadata for ad tracking: \" + err);\n            }\n        }\n        return false;\n    }, [errorContext, lastDataRange]);\n\n    const loadMedia = useCallback(async (url) => {\n        let manifestUrl, adTrackingMetadataUrl;\n        try {\n            const response = await fetch(url, { redirect: 'follow', cache: 'reload' });\n            if (response.status < 200 || response.status > 299) {\n                throw new Error(`Get unexpected response code ${response.status}`);\n            }\n\n            if (response.redirected) {\n                manifestUrl = response.url;\n                adTrackingMetadataUrl = rewriteUrlToMetadataUrl(response.url);\n            } else {\n                manifestUrl = url;\n                adTrackingMetadataUrl = rewriteUrlToMetadataUrl(url);\n            }\n        } catch (err) {\n            errorContext.reportError(\"manifest.request.failed\", \"Failed to download manifest: \" + err);\n            return;\n        }\n\n        // workaround HLS issue that video stream needs to get first otherwise there is error \"Manipulated manifest does not contain any segments\"\n        if (manifestUrl.includes('index.m3u8')) {\n            await fetch(manifestUrl.replace(\"index.m3u8\", \"01.m3u8\"));\n        }\n\n        setAdPods([]);\n        adTrackerRef.current = new SimpleAdTracker();\n        const pods = adTrackerRef.current.getAdPods();\n        adTrackerRef.current.addUpdateListener(() => {\n            setAdPods([...pods]);  // trigger re-render\n        });\n\n        setSessionInfo({\n            localSessionId: new Date().toISOString(),\n            mediaUrl: url,\n            manifestUrl: manifestUrl,\n            adTrackingMetadataUrl: adTrackingMetadataUrl\n        });\n\n        await refreshMetadata(adTrackingMetadataUrl);\n    }, [refreshMetadata, errorContext]);\n\n    const unload = () => {\n        setAdPods([]);\n        adTrackerRef.current = new SimpleAdTracker();\n        const pods = adTrackerRef.current.getAdPods();\n        adTrackerRef.current.addUpdateListener(() => {\n            setAdPods([...pods]);  // trigger re-render\n        });\n\n        setPresentationStartTime(0);\n\n        setSessionInfo({\n            localSessionId: \"\",\n            mediaUrl: null,\n            manifestUrl: null,\n            adTrackingMetadataUrl: \"\"\n        });\n    }\n\n    useEffect(() => {\n        if (sessionInfo.mediaUrl && !sessionInfo.localSessionId) {\n            loadMedia(sessionInfo.mediaUrl);\n        }\n    }, [loadMedia, sessionInfo]);\n\n    useInterval(async () => {\n        const isInRange = (time: number, prft: boolean) => {\n            if (prft && lastDataRange.prftStart && lastDataRange.prftEnd) {\n                return time >= lastDataRange.prftStart && time <= lastDataRange.prftEnd - EARLY_FETCH_MS;\n            } else {\n                return time >= lastDataRange.start && time <= lastDataRange.end - EARLY_FETCH_MS;\n            }\n        }\n\n        console.log(`PRFT: ${lastPrftPlayheadTime}; In range: ${isInRange(lastPrftPlayheadTime, true)}`);\n        console.log(`Raw: ${lastPlayheadTime}; In range: ${isInRange((lastPlayheadTime), false)}`);\n\n        let url = sessionInfo.adTrackingMetadataUrl;\n        if (!url) return;\n\n        if (lastDataRange.prftStart && lastDataRange.prftEnd && lastPrftPlayheadTime > 0) {\n            if (!isInRange(lastPrftPlayheadTime, true) &&\n                !(await refreshMetadata(url, lastPrftPlayheadTime, true))) {\n                    url = `${url}&prftStart=${lastPrftPlayheadTime}`;\n                    refreshMetadata(url);\n            }\n        } else if (lastPlayheadTime &&\n            !isInRange((lastPlayheadTime), false) &&\n            !(await refreshMetadata(url, lastPlayheadTime, false))) {\n            url = `${url}&start=${lastPlayheadTime}`;\n            refreshMetadata(url);\n        }\n    }, 4000);\n\n    const sessionContext: SessionContextInterface = {\n        sessionInfo: sessionInfo,\n        presentationStartTime: presentationStartTime,\n        load: (url) => {\n            history.replace(\"?url=\" + encodeURIComponent(url));\n            return loadMedia(url);\n        },\n        unload: unload\n    };\n\n    const adTrackingContext: SimpleAdTrackerInterface = {\n        adPods: adPods,\n        lastPlayheadTime,\n        presentationStartTime,\n        updatePlayheadTime: (time) => {\n            setLastPlayheadTime(time);\n        },\n        updatePrftPlayheadTime: (time) => {\n            setLastPrftPlayheadTime(time);\n        },\n        updatePresentationStartTime: (time) => {\n            setPresentationStartTime(time);\n        },\n        needSendBeacon: (time) => adTrackerRef.current?.needSendBeacon(time),\n        pause: () => adTrackerRef.current?.pause(),\n        resume: () => adTrackerRef.current?.resume(),\n        mute: () => adTrackerRef.current?.mute(),\n        unmute: () => adTrackerRef.current?.unmute()\n    };\n\n    return (\n        <SessionContext.Provider value={sessionContext}>\n            <AdTrackingContext.Provider value={adTrackingContext}>\n                {props.children}\n            </AdTrackingContext.Provider>\n        </SessionContext.Provider>\n    );\n};\n\nexport default AdTrackingPlaybackSessionProvider;\n","import React, {Component, createRef} from \"react\";\nimport \"@harmonicinc/shaka-player/dist/controls.css\";\nimport muxjs from 'mux.js';\n\nimport \"@harmonicinc/shaka-player/dist/shaka-player.ui\";\n// @ts-ignore\nimport shaka from \"@harmonicinc/shaka-player/dist/shaka-player.ui\";\nimport ShakaPlayerInterface from \"../types/ShakaPlayerInterface\";\nimport ShakaPlayerProps from \"../types/ShakaPlayerProps\";\n\nclass ShakaPlayer extends Component<ShakaPlayerProps> implements ShakaPlayerInterface {\n  player: shaka.Player | null;\n\n  private readonly videoRef: React.RefObject<HTMLVideoElement>;\n  private readonly containerRef: React.RefObject<HTMLDivElement>;\n  private lastMuted: boolean;\n  private paused: boolean;\n\n  constructor(props: ShakaPlayerProps) {\n    super(props);\n    this.videoRef = createRef();\n    this.containerRef = createRef();\n    this.player = null;\n    this.lastMuted = false;\n    this.paused = false;\n  }\n\n\n  componentDidMount() {\n    window.muxjs = muxjs;\n\n    const video = this.videoRef.current;\n    const container = this.containerRef.current;\n\n    if (!video || !container) return;\n\n    this.player = new shaka.Player(video);\n    this.player.configure('manifest.defaultPresentationDelay', 12.0 /* seconds */);\n    this.player.configure('manifest.dash.ignoreSuggestedPresentationDelay', true);\n    this.lastMuted = video.muted;\n\n    if (!this.player) return;\n\n    const ui = new shaka.ui.Overlay(this.player, container, video);\n    ui.configure({\n      controlPanelElements: [\n        \"play_pause\",\n        \"mute\",\n        \"volume\",\n        \"fullscreen\",\n        \"overflow_menu\"\n      ]\n    });\n\n    video.addEventListener('error', (err) => this.props.onError?.(err));\n    video.addEventListener('playing', () => {\n      if (!ui.getControls()?.isSeeking()) {\n        if (this.paused) {\n          this.props.onResume?.();\n          this.paused = false;\n        }\n      }\n    });\n    video.addEventListener('pause', () => {\n      if (!ui.getControls()?.isSeeking()) {\n        this.props.onPaused?.();\n        this.paused = true;\n      }\n    });\n    video.addEventListener('volumechange', () => {\n      if (video.muted && !this.lastMuted) {\n        this.props.onMute?.();\n      } else if (!video.muted && this.lastMuted) {\n        this.props.onUnmute?.();\n      }\n      this.lastMuted = video.muted;\n    });\n  }\n\n  load(url: string) {\n    this.player?.load(url);\n    this.paused = false;\n  }\n\n  unload() {\n    this.player?.unload();\n    this.paused = false;\n  }\n\n  getPlayheadTimeAsDate() {\n    return this.player?.getPlayheadTimeAsDate() || null;\n  }\n\n  getRawVideoTime() {\n    return this.videoRef.current?.currentTime || null;\n  }\n\n  getPresentationLatencyInfo(): {type: string, latency: number, wallClock: Date} {\n    return this.player?.getPresentationLatencyInfo() || null;\n  }\n\n  getPresentationStartTime(): Date {\n    return this.player?.getPresentationStartTimeAsDate()\n  }\n\n  render() {\n    return (\n      <div\n        ref={this.containerRef}\n        style={{ maxWidth: this.props.width }}>\n        <video\n            data-shaka-player\n            ref={this.videoRef}\n            style={{ width: \"100%\", height: \"100%\", backgroundColor: \"black\" }}\n            autoPlay={true}>\n        </video>\n      </div>\n    );\n  }\n}\n\nexport default ShakaPlayer;\n","import { useContext, useEffect, useRef, useState } from 'react';\nimport ShakaPlayer from './ShakaPlayer';\nimport SessionContext from './SessionContext';\nimport AdTrackingContext from './AdTrackingContext';\nimport useInterval from './useInterval';\nimport SessionContextInterface from \"../types/SessionContextInterface\";\nimport SimpleAdTrackerInterface from \"../types/SimpleAdTrackerInterface\";\n\nfunction PlayerContainer() {\n    const sessionContext = useContext<SessionContextInterface | undefined>(SessionContext);\n\n    if (sessionContext === undefined) {\n        throw new Error('SessionContext is undefined');\n    }\n\n    const sessionInfo = sessionContext.sessionInfo;\n\n    const adTrackingContext = useContext<SimpleAdTrackerInterface | undefined>(AdTrackingContext);\n\n    if (adTrackingContext === undefined) {\n        throw new Error('SessionContext is undefined');\n    }\n\n    const shakaRef = useRef<ShakaPlayer>(null);\n\n    const localSessionRef = useRef<any>();\n\n    const [rawCurrentTime, setRawCurrentTime] = useState(0);\n    const [playhead, setPlayhead] = useState(0);\n    const [prftWallClock, setPrftWallClock] = useState(0);\n    const [streamFormat, setStreamFormat] = useState<string | null>(null);\n\n    const updateTime = (time: number) => {\n        setRawCurrentTime(time);\n\n        if (sessionInfo.manifestUrl?.includes(\".m3u8\")) {\n            const clockTime = shakaRef.current?.getPlayheadTimeAsDate()?.getTime() || 0;\n            adTrackingContext.updatePlayheadTime(clockTime);\n            adTrackingContext.needSendBeacon(clockTime);\n            setPlayhead(clockTime);\n            setStreamFormat('HLS');\n        } else if (sessionInfo.manifestUrl?.includes(\".mpd\")) {\n            const prftClockTime = shakaRef.current?.getPresentationLatencyInfo()?.wallClock.getTime() || 0;\n            const rawClockTime = time * 1000;\n            const presentationStartTime = shakaRef.current?.getPresentationStartTime()?.getTime() || 0;\n            const clockTime = rawClockTime + presentationStartTime;\n            adTrackingContext.updatePrftPlayheadTime(prftClockTime);\n            adTrackingContext.updatePlayheadTime(rawClockTime);\n            adTrackingContext.updatePresentationStartTime(presentationStartTime);\n            adTrackingContext.needSendBeacon(prftClockTime > 0 ? prftClockTime : rawClockTime);\n            setPrftWallClock(prftClockTime);\n            setPlayhead(clockTime);\n            setStreamFormat('DASH');\n        }\n    };\n\n    const onError = (error: ErrorEvent) => {\n      console.error(\"Error from player\", error);\n    }\n\n    const timeMsToNextBreak = () => {\n        let wallClock = 0;\n        if (streamFormat === 'HLS') {\n            wallClock = playhead;\n        } else if (streamFormat === 'DASH') {\n            wallClock = prftWallClock || (rawCurrentTime * 1000);\n        } else {\n            return Infinity;\n        }\n        return Math.min(Infinity, ...adTrackingContext.adPods\n            .filter(p => p.startTime > wallClock)\n            .map(p => p.startTime))\n            - wallClock;\n    }\n\n    useInterval(() => {\n        const time = shakaRef.current?.getRawVideoTime();\n        if (time) updateTime(time);\n    }, 500);\n\n    useEffect(() => {\n        if (shakaRef.current && localSessionRef.current !== sessionInfo.localSessionId) {\n            if (sessionInfo.manifestUrl) {\n                shakaRef.current.load(sessionInfo.manifestUrl);\n            } else {\n                shakaRef.current.unload();\n            }\n            localSessionRef.current = sessionInfo.localSessionId\n        }\n    }, [shakaRef, sessionInfo]);\n\n    return (\n        <div>\n            <ShakaPlayer ref={shakaRef}\n                onPaused={() => {\n                    console.log('playback paused');\n                    adTrackingContext.pause();\n                }}\n                onResume={() =>{\n                    console.log('playback resumed from pause');\n                    adTrackingContext.resume()\n                }}\n                onMute={() => {\n                    console.log('player muted');\n                    adTrackingContext.mute();\n                }}\n                onUnmute={() => {\n                    console.log('player unmute');\n                    adTrackingContext.unmute();\n                }}\n                onError={onError}/>\n            <div>\n                Raw currentTime from video element: {rawCurrentTime ? rawCurrentTime.toFixed(0) : 0}s\n            </div>\n            <div>\n                Playhead date time: {playhead ? new Date(playhead).toLocaleString() : '-'}\n            </div>\n            <div>\n                PRFT Wall Clock: {prftWallClock ? new Date(prftWallClock).toLocaleString() : '-'}\n            </div>\n            <div>\n                Time to next ad break: {timeMsToNextBreak() !== Infinity ? Math.ceil(timeMsToNextBreak() /1000).toFixed(0) + 's' : '-'}\n            </div>\n        </div>\n    );\n}\n\nexport default PlayerContainer;\n","import React, { useContext, useRef, MouseEvent } from 'react';\nimport makeStyles from '@mui/styles/makeStyles';\nimport { Box, Button, Link, Snackbar, TextField, Typography } from '@mui/material';\nimport MuiAlert from '@mui/material/Alert';\nimport { ErrorContext } from './ErrorContext';\nimport SessionContext from './SessionContext';\nimport {theme} from \"./App\";\n\nconst useStyles = makeStyles(() => ({\n  buttons: {\n    '& > *': {\n      marginRight: theme.spacing(1),\n    },\n  }\n}));\n\nfunction InfoSection() {\n  const classes = useStyles();\n\n  const errorContext = useContext(ErrorContext);\n\n  const sessionContext = useContext(SessionContext);\n\n  if (sessionContext === undefined) {\n    throw new Error('SessionContext is undefined');\n  }\n\n  const sessionInfo = sessionContext.sessionInfo;\n\n  const urlInputRef = useRef<any>();\n\n  const preventDefault = (event: MouseEvent<HTMLAnchorElement | HTMLSpanElement>) => event.preventDefault();\n\n  const load = async () => {\n    await sessionContext.load(urlInputRef.current.value);\n  }\n\n  const unload = () => {\n    sessionContext.unload();\n  }\n\n  const closeAlert = (errorKey: string) => {\n    errorContext.acknowledgeError(errorKey);\n  }\n\n  return (\n    <div>\n      {\n        Object.entries(errorContext.errors).map(([key, error], i) => (\n          <Snackbar anchorOrigin={{ vertical: 'top', horizontal: 'right' }} open={!error.acknowledged} key={i}>\n            <MuiAlert elevation={6} variant=\"filled\" severity=\"error\" onClose={() => closeAlert(key)}>\n              {error.message}\n            </MuiAlert>\n          </Snackbar>\n        ))\n      }\n\n      <Typography variant=\"h5\" gutterBottom>\n        Harmonic Client Side Ad Tracking Demo\n      </Typography>\n      <TextField inputRef={urlInputRef} label=\"Media URL\" fullWidth={true} defaultValue={sessionInfo.mediaUrl || ''} variant={'standard'} />\n      <Box className={classes.buttons} width={1} paddingTop={2} display=\"flex\" flexDirection=\"row\">\n        <Button variant=\"contained\" color=\"primary\" onClick={load}>\n          Load\n        </Button>\n        <Button variant=\"contained\" color=\"secondary\" onClick={unload}>\n          Unload\n        </Button>\n      </Box>\n      <Box width={1} paddingTop={2} display=\"flex\" flexDirection=\"row\">\n        <Link href=\"#\" color=\"inherit\" onClick={preventDefault} underline=\"hover\">\n          {sessionInfo.manifestUrl ? sessionInfo.manifestUrl : ''}\n        </Link>\n      </Box>\n      <Box width={1} paddingTop={1} display=\"flex\" flexDirection=\"row\">\n        <Link href=\"#\" color=\"inherit\" onClick={preventDefault} underline=\"hover\">\n          {sessionInfo.adTrackingMetadataUrl ? sessionInfo.adTrackingMetadataUrl : ''}\n        </Link>\n      </Box>\n    </div>\n  );\n}\n\nexport default InfoSection;\n","import './App.css'\nimport { createTheme, ThemeProvider, StyledEngineProvider } from '@mui/material/styles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Container from '@mui/material/Container'\nimport Grid from '@mui/material/Grid'\nimport Paper from '@mui/material/Paper'\nimport Tabs from '@mui/material/Tabs'\nimport Tab from '@mui/material/Tab'\nimport AdPodList from './AdPodList'\nimport { DefaultErrorContextProvider } from './ErrorContext'\nimport AdTrackingPlaybackSessionProvider\n  from './AdTrackingPlaybackSessionProvider'\nimport PlayerContainer from './PlayerContainer'\nimport InfoSection from './InfoSection'\nimport { Route, BrowserRouter } from 'react-router-dom'\n\nexport const theme = createTheme({\n  palette: {\n    primary: {\n      main: '#3f51b5',\n    },\n    secondary: {\n      main: '#e0e0e0',\n    },\n  },\n})\n\nconst useStyles = makeStyles(() => ({\n  paper: {\n    padding: theme.spacing(2),\n    textAlign: 'center',\n    color: theme.palette.text.secondary,\n  },\n}))\n\nfunction App () {\n  const classes = useStyles()\n\n  return (\n    <StyledEngineProvider injectFirst>\n      <ThemeProvider theme={theme}>\n        <BrowserRouter basename=\"/client-side-ad-tracking-demo\">\n          <Route exact path=\"/\">\n            <DefaultErrorContextProvider>\n              <AdTrackingPlaybackSessionProvider>\n                <Container>\n                  <Grid container spacing={3}>\n                    <Grid item xs={12}>\n                      <Paper square className={classes.paper}>\n                        <InfoSection/>\n                      </Paper>\n                    </Grid>\n                    <Grid item xs={12} sm={6}>\n                      <Paper square className={classes.paper}>\n                        <PlayerContainer/>\n                      </Paper>\n                    </Grid>\n                    <Grid item xs={12} sm={6}>\n                      <Paper square className={classes.paper}>\n                        <Tabs\n                          value={0}\n                          indicatorColor=\"primary\"\n                          textColor=\"primary\">\n                          <Tab label=\"Tracking Events\"/>\n                        </Tabs>\n                        <AdPodList/>\n                      </Paper>\n                    </Grid>\n                  </Grid>\n                </Container>\n              </AdTrackingPlaybackSessionProvider>\n            </DefaultErrorContextProvider>\n          </Route>\n        </BrowserRouter>\n      </ThemeProvider>\n    </StyledEngineProvider>\n  );\n}\n\nexport default App\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport CssBaseline from '@mui/material/CssBaseline';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nif (process.env.NODE_ENV === 'production') {\n    console.log = () => {}\n    console.debug = () => {}\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <CssBaseline />\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}